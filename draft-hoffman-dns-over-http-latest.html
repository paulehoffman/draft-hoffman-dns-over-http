<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DNS Queries over HTTPS</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Use Cases"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Protocol Requirements"/>
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Template"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 PREFIX"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 QNAME"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 QTYPE"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Additional Parameters"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Queries"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Responses"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Use in HTTP/2"/>
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="9 References"/>
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Previous Work on DNS over HTTP or in Other Formats"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Hoffman, P. and J. Hildebrand" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-hoffman-dns-over-http" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-10-15" />
  <meta name="dct.abstract" content="This document describes how to make DNS queries and get DNS responses over HTTPS. The main driver for this document is to allow clients who want to send DNS queries over HTTP transport to be able to do in a secure and interoperable fashion, regardless of the format of the responses." />
  <meta name="description" content="This document describes how to make DNS queries and get DNS responses over HTTPS. The main driver for this document is to allow clients who want to send DNS queries over HTTP transport to be able to do in a secure and interoperable fashion, regardless of the format of the responses." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">P. Hoffman</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">ICANN</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">J. Hildebrand</td>
</tr>
<tr>
  <td class="left">Expires: April 18, 2017</td>
  <td class="right">October 15, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DNS Queries over HTTPS<br />
  <span class="filename">draft-hoffman-dns-over-http</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes how to make DNS queries and get DNS responses over HTTPS. The main driver for this document is to allow clients who want to send DNS queries over HTTP transport to be able to do in a secure and interoperable fashion, regardless of the format of the responses.</p>
<p>Comments on this draft can be sent to the dnsoverhttp mailing list at <a href="https://www.ietf.org/mailman/listinfo/dnsoverhttp">https://www.ietf.org/mailman/listinfo/dnsoverhttp</a>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 18, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Use Cases</a></li>
<li>1.2.   <a href="#rfc.section.1.2">Protocol Requirements</a></li>
<li>1.3.   <a href="#rfc.section.1.3">Terminology</a></li>
</ul><li>2.   <a href="#rfc.section.2">Template</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">PREFIX</a></li>
<li>2.2.   <a href="#rfc.section.2.2">QNAME</a></li>
<li>2.3.   <a href="#rfc.section.2.3">QTYPE</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Additional Parameters</a></li>
</ul><li>3.   <a href="#rfc.section.3">Queries</a></li>
<li>4.   <a href="#rfc.section.4">Responses</a></li>
<li>5.   <a href="#rfc.section.5">Use in HTTP/2</a></li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a></li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a></li>
<li>9.   <a href="#rfc.references">References</a></li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Previous Work on DNS over HTTP or in Other Formats</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">Over time, there have been many proposals for using HTTP and HTTPS as a substrate for DNS queries and responses. To date, none of those proposals have made it beyond early discussion, partially due to disagreement about what is the &#8220;best&#8221; method to do so. In particular, there has been disagreement about what the best format for the responses should be. Also, some early proposals have not followed best practices for using HTTP.</p>
<p id="rfc.section.1.p.2">This document defines a specific protocol for sending DNS <a href="#RFC1035">[RFC1035]</a> queries and getting DNS responses over HTTP <a href="#RFC7230">[RFC7230]</a> that is running over TLS <a href="#RFC5246">[RFC5246]</a>. Although there might be a desire to run this protocol over an insecure transport such as bare HTTP, this document only defines the protocol as HTTP over TLS.</p>
<p id="rfc.section.1.p.3">This design focuses on DNS stub-to-resolver communication, but DNS resolver-to-authoritative communication should work just as well.</p>
<p id="rfc.section.1.p.4">A server that supports this protocol is called a &#8220;DNS API server&#8221; to differentiate it from a &#8220;DNS server&#8221; (one that uses the regular DNS protocol). Similarly, a client supports this protocol is called a &#8220;DNS API client&#8221;.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#use-cases" id="use-cases">Use Cases</a></h1>
<p id="rfc.section.1.1.p.1">Earlier proposals for DNS over HTTP have had many different use cases. The primary use case is an application that wants to avoid network path involvement with DNS. The protocol can be implemented in the application such as a browser if the location of the DNS API server can be configured, hard-coded, or discoverable such as through DHCP.</p>
<p id="rfc.section.1.1.p.2">Another use case is an operating system that wants to help applications when the OS detects broken DNS in its operations. The OS can still respond to calls such as getaddrinfo() and gethostbyname() by using this protocol without the applications needing to do anything.</p>
<p id="rfc.section.1.1.p.3">A more recent use case is a small (&#8220;IoT&#8221;) device that already runs COAP <a href="#RFC7252">[RFC7252]</a> and has a JSON <a href="#RFC7159">[RFC7159]</a> or CBOR <a href="#RFC7049">[RFC7049]</a> parser and wants to make DNS queries beyond what are supported by the device&#8217;s operating system.</p>
<p id="rfc.section.1.1.p.4">An eventual use case might be editing of DNS zones by end users, such as described in <a href="#I-D.hildebrand-deth">[I-D.hildebrand-deth]</a>. Such editing could easily be done using existing HTTP semantics.</p>
<p id="rfc.section.1.1.p.5">As HTTP/2 <a href="#RFC7540">[RFC7540]</a> and QUIC <a href="#I-D.hamilton-early-deployment-quic">[I-D.hamilton-early-deployment-quic]</a> become more widely deployed, this protocol might become more important because an HTTP/2 or QUIC server might push DNS responses to a client that the HTTP/2 server expects the client to look up.  This will be covered in <a href="#h2">Section 5</a>. TODO: this discussion of H2 push needs to be expanded by people with this use case.</p>
<p id="rfc.section.1.1.p.6">These use cases assume that the server is a resolver, but this protocol can certainly be used in use cases where the server is an authoritative server. Such use cases may be added to this document, or may be documented later.</p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#protocol-requirements" id="protocol-requirements">Protocol Requirements</a></h1>
<p id="rfc.section.1.2.p.1">The protocol described here bases its design on the following protocol requirements:</p>
<p/>

<ul>
  <li>The protocol must use HTTP semantics the way that they are commonly used in other protocols; there is nothing special about the DNS use case.</li>
  <li>The protocol must run over secure transport.</li>
  <li>The query format must be able to be flexible enough to express every normal DNS query.</li>
  <li>The response must be able to be in different formats that can be described by different documents.</li>
  <li>Both the query format and the response formats must be extensible.  In specific, a query must be able to contain one or more EDNS extensions, including those not yet defined. Further, it must be easy to define different response formats and to extend already-defined formats.</li>
</ul>
<p id="rfc.section.1.2.p.3">Non-requirements:</p>
<p/>

<ul>
  <li>Supporting network-specific DNS64 <a href="#RFC6147">[RFC6147]</a></li>
  <li>Supporting other network-specific inferences from plaintext DNS queries</li>
</ul>
<h1 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.3.p.1">In this document, the key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; are to be interpreted as described in BCP 14, RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#template" id="template">Template</a></h1>
<p id="rfc.section.2.p.1">The URI template (see <a href="#RFC6570">[RFC6570]</a>) for DNS API queries is:</p>
<pre>
{PREFIX}{QNAME}/{QTYPE}
</pre>
<p><a href="#I-D.nottingham-json-home">[I-D.nottingham-json-home]</a> will be evaluated in the future to see if the added complexity of including it in the discovery process would make for an interesting increase in deployment flexibility.</p>
<p id="rfc.section.2.p.3">The following variables are used to expand the URI template.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#prefix" id="prefix">PREFIX</a></h1>
<p id="rfc.section.2.1.p.1">&#8220;PREFIX&#8221; will be a URI fragment, such as &#8220;https://example.net/api/&#8221;.  The URI protocol MUST be &#8220;https:&#8221; or &#8220;coaps:&#8221;.  The prefix MUST NOT contain the character &#8220;?&#8221;, and MUST be suitable for processing using the above template.  Often, this will mean that the template should end with a &#8220;/&#8221; (U+002F: SOLIDUS).</p>
<p id="rfc.section.2.1.p.2">The DNS API client discovers the PREFIX for the DNS API through the same mechanism as for a DNS resolver: DHCPv4, DHCPv6, IPv6 RA, and configuration.  Specific PREFIX discovery mechanisms will be defined later, but imagine a new DHCP or RA option that gives a PREFIX.</p>
<p id="rfc.section.2.1.p.3">If no PREFIX is configured as above, the client MAY query a DNS resolver for which they have an IP address. The query is</p>
<pre>
   https://&lt;IPADDRESS&gt;/.well_known/TBD1
</pre>
<p id="rfc.section.2.1.p.4">If the DNS server knows about API support, the returned URI will be the PREFIX.</p>
<p id="rfc.section.2.1.p.5">The response to this discovery might be multiple PREFIXes. In that case, some of the URI types might not be supported by the resolver; this is fine as long as at least one type is.  For example, if a discovery query returns both https: and coaps: URI templates, but the DNS API client can only generate https: queries, the other URI templates are ignored.</p>
<p id="rfc.section.2.1.p.6">TODO: there are several concerns to be worked out with respect to the PREFIX, including how to bootstrap PREFIXes that contain domain names, and how to trust TLS connections to PREFIXes that contain only IP addresses in a deployable way.  Some ideas might come from RFC 7858.</p>
<p id="rfc.section.2.1.p.7">Note: The discovery response may give hints that the DNS API server requires a form of HTTP authorization. The configuration of that authorization is out of scope for the DNS API protocol. TODO: Need to think about HTTP authorization mechanisms. This would allow user tracking, but could also free resolvers from having to use IP address ranges for filtering.  Several bad ideas are likely here, so let&#8217;s think about it early.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#qname" id="qname">QNAME</a></h1>
<p id="rfc.section.2.2.p.1">The QNAME is adopted from <a href="#RFC1035">[RFC1035]</a>.</p>
<p id="rfc.section.2.2.p.2">TODO: how to encode non-ASCII domain names.  For IDNs, there are several options:</p>
<p/>

<ul>
  <li>Punycode all labels before sending</li>
  <li>Send the UTF8-encoded version after normalization, but before Punycoding</li>
  <li>Send generic UTF8-encoded labels, and make the server do normalization</li>
</ul>
<p id="rfc.section.2.2.p.4">TODO: domain names (not host names) that have values that might cause problems in the URI format, such as values that are control characters in ASCII, and values greater than 127.</p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#qtype" id="qtype">QTYPE</a></h1>
<p id="rfc.section.2.3.p.1">The numerical QTYPE is adopted from <a href="#RFC1035">[RFC1035]</a>.</p>
<p id="rfc.section.2.3.p.2">TODO: there are some people that want to use the string forms, such as &#8220;AAAA&#8221;, perhaps in addition to the numerical form.  To be discussed.</p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#parameters" id="parameters">Additional Parameters</a></h1>
<p id="rfc.section.2.4.p.1">The following are the names and descriptions of parameters for DNS API queries.  All parameters are optional. DNS header values and extensions that are not appropriate for queries are not defined.  Each parameter in the list below will need to include a use case in a later version of this document; this list is a first approximation of what may be needed.</p>
<p id="rfc.section.2.4.p.2">Each of these parameters may be used in a query component of the URI sent to the API, to modify the request.</p>
<p/>

<dl>
  <dt>qc:</dt>
  <dd style="margin-left: 8">QCLASS from <a href="#RFC1035">[RFC1035]</a> &#8211; if omitted, server assumes 1 (IN).  Might be needed to support legacy DNS classes, or to access interesting new DNS capabilities.</dd>
  <dt>id:</dt>
  <dd style="margin-left: 8">ID from <a href="#RFC1035">[RFC1035]</a> &#8211; if omitted, there is no default value.  Could be used to track responses.</dd>
  <dt>opcode:</dt>
  <dd style="margin-left: 8">Opcode from <a href="#RFC1035">[RFC1035]</a> &#8211;  if omitted, server assumes 0 (standard query)</dd>
  <dt>rd:</dt>
  <dd style="margin-left: 8">RD from <a href="#RFC1035">[RFC1035]</a> &#8211; if omitted, server assumes 1 (recursion desired)</dd>
  <dt>cd:</dt>
  <dd style="margin-left: 8">CD from <a href="#RFC4035">[RFC4035]</a> &#8211; if omitted, server assumes 1 (DNSSec checking by the resolver disabled)</dd>
  <dt>do:</dt>
  <dd style="margin-left: 8">DO from <a href="#RFC4035">[RFC4035]</a> &#8211; if omitted, server assumes 1 (include RRSIG RDATA in the response)</dd>
</dl>
<p id="rfc.section.2.4.p.4">The following are EDNS0 <a href="#RFC6891">[RFC6891]</a> extensions. If an extension is omitted, the server assumes that the extension was not given in the request.</p>
<p/>

<dl>
  <dt>nsid:</dt>
  <dd style="margin-left: 8">Request the server&#8217;s NSID, based on <a href="#RFC5001">[RFC5001]</a>.  Set to &#8220;1&#8221; to enable.</dd>
  <dt>dau:</dt>
  <dd style="margin-left: 8">Specify the list of signing algorithms understood, based on <a href="#RFC6975">[RFC6975]</a>.  The value is a list of integers separated by commas (with no spaces).</dd>
  <dt>dhu:</dt>
  <dd style="margin-left: 8">Specify the list of hash algorithms understood, based on <a href="#RFC6975">[RFC6975]</a>.  The value is a list of integers separated by commas (with no spaces).</dd>
  <dt>n3u:</dt>
  <dd style="margin-left: 8">Specify the list of NSEC3 hash algorithms understood, based on <a href="#RFC6975">[RFC6975]</a>.  The value is a list of integers separated by commas (with no spaces).</dd>
  <dt>ecs:</dt>
  <dd style="margin-left: 8">Specify the client subnet, based on <a href="#RFC7871">[RFC7871]</a>.  The value is the bytes of the ECS option, starting with byte 4, encoded in lowercase hexadecimal.</dd>
  <dt>pad:</dt>
  <dd style="margin-left: 8">Optional padding, used for the same purposes as described in <a href="#RFC7830">[RFC7830]</a>.  This can be used to normalize the length of queries.</dd>
</dl>
<p id="rfc.section.2.4.p.6">See <a href="#ianacons">Section 6</a> for a registry for additional names for queries.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#queries" id="queries">Queries</a></h1>
<p id="rfc.section.3.p.1">To send a DNS query, the DNS API client prepares an HTTP/CoAP GET request using the template (see <a href="#template">Section 2</a>).  If any additional parameters (see <a href="#parameters">Section 2.4</a>) are desired, they are appended to the template as if they are HTML form data. (See Sections 4.10.22.3  and 4.10.22.4 of <a href="#HTMLSPEC">[HTMLSPEC]</a> for the full specification of form data.) Typically, this is done using a &#8220;?&#8221; (U+003F: QUESTION MARK), then each parameter specified as a name, &#8220;=&#8221; (U+003D: EQUALS SIGN), and value, each name=value pair separated by a &#8220;&amp;&#8221; (U+0026: AMPERSAND). Each value should be percent-encoded as needed. The client MUST ensure that the resulting URI is valid.</p>
<p id="rfc.section.3.p.2">The HTTP-related requirements include:</p>
<p/>

<ul>
  <li>The HTTP GET request MUST have no body.</li>
  <li>The HTTP GET request SHOULD be sent with an HTTP &#8220;Accept:&#8221; header to say what type of content can be returned; of course, a server can return whatever type of content it wants. If the request does not have an HTTP &#8220;Accept:&#8221; header, the DNS API server might return a content type that the DNS API client does not understand.</li>
  <li>The HTTP GET request SHOULD use If-None-Match headers if earlier responses to the same query used HTTP ETag headers as described in <a href="#RFC7232">[RFC7232]</a>.</li>
</ul>
<p id="rfc.section.3.p.4">For example, assume that the server&#8217;s PREFIX is:</p>
<pre>
   https://dnsserver.example.net/api/v1/
</pre>
<p id="rfc.section.3.p.5">A query for the A records for &#8220;www.example.com&#8221; with recursion turned off would be:</p>
<pre>
   https://dnsserver.example.net/api/v1/www.example.com/1?rd=0
</pre>
<p id="rfc.section.3.p.6">The HTTP request might look like:</p>
<pre>
   GET api/v1/www.example.com/1?rd=0 HTTP/1.1
   User-Agent: curl/7.16.3 libcurl/7.16.3
   Host: dnsserver.example.net
   Accept: application/dns+json
</pre>
<p id="rfc.section.3.p.7">This document only defines the semantics of the HTTP/CoAP GET command for normal DNS queries and responses. Other verbs will be defined in the future.  Other verbs will likely need different authorization semantics.  For example, see <a href="#I-D.hildebrand-deth">[I-D.hildebrand-deth]</a>.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#responses" id="responses">Responses</a></h1>
<p id="rfc.section.4.p.1">Different response formats will provide more or less information from a DNS response. For example, one response type might include the information from the DNS header bytes while another might omit it. The amount and type of information that a response format gives is solely up to the format, and not defined in this protocol.</p>
<p id="rfc.section.4.p.2">At the time this is published, the response types are works in progress. The know response types include:</p>
<p/>

<ul>
  <li><a href="#I-D.hoffman-dns-in-json">[I-D.hoffman-dns-in-json]</a> describes a response type in JSON</li>
  <li><a href="#I-D.song-dns-wireformat-http">[I-D.song-dns-wireformat-http]</a> describes a response type in DNS wire format</li>
</ul>
<p id="rfc.section.4.p.4">In the HTTP responses, the HTTP cache headers are set to shortest DNS TTL in the response.  The HTTP responses SHOULD set the HTTP ETag headers as described in <a href="#RFC7232">[RFC7232]</a>.</p>
<p id="rfc.section.4.p.5">TODO: Add more detail about setting the HTTP cache headers.</p>
<p id="rfc.section.4.p.6">TODO: Add examples of creating these ETag headers.</p>
<p id="rfc.section.4.p.7">Servers conforming to this protocol MUST implement responding with messages formatted with <a href="#I-D.hoffman-dns-in-json">[I-D.hoffman-dns-in-json]</a>.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#h2" id="h2">Use in HTTP/2</a></h1>
<p id="rfc.section.5.p.1">TODO: Full discussion about using this protocol in HTTP/2 for server push.  This will also hopefully cover caching and DNS TTLs.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#ianacons" id="ianacons">IANA Considerations</a></h1>
<p id="rfc.section.6.p.1">TODO: Create a new registry for option names for DNS queries.  This will be a simple registry for new option names, probably with a designated expert.</p>
<p id="rfc.section.6.p.2">TODO: Replace TBD1 in the body with a string from the .well_known registry.  Reference <a href="#RFC5785">[RFC5785]</a>.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#securitycons" id="securitycons">Security Considerations</a></h1>
<p id="rfc.section.7.p.1">This protocol requires the use of TLS for communication. If a client does not enforce authentication of the TLS server, the communication channel will be susceptible to many security problems. See <a href="#RFC7435">[RFC7435]</a> for a fuller description of non-authenticated TLS.</p>
<p id="rfc.section.7.p.2">TODO: Think about whether cross-origin resource sharing (CORS) applies to this protocol and, if so, how to specify it.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.8.p.1">Early input to this document came from Mark Nottingham and and Patrick McManus.</p>
<h1 id="rfc.references"><a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="HTMLSPEC">[HTMLSPEC]</b>
      </td>
      <td class="top"><a>W3C</a>, "<a href="https://www.w3.org/TR/html5/">HTML5, A vocabulary and associated APIs for HTML and XHTML</a>", 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1035">[RFC1035]</b>
      </td>
      <td class="top"><a>Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, DOI 10.17487/RFC1035, November 1987.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4035">[RFC4035]</b>
      </td>
      <td class="top"><a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4035">Protocol Modifications for the DNS Security Extensions</a>", RFC 4035, DOI 10.17487/RFC4035, March 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6570">[RFC6570]</b>
      </td>
      <td class="top"><a>Gregorio, J.</a>, <a>Fielding, R.</a>, <a>Hadley, M.</a>, <a>Nottingham, M.</a> and <a>D. Orchard</a>, "<a href="http://tools.ietf.org/html/rfc6570">URI Template</a>", RFC 6570, DOI 10.17487/RFC6570, March 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7230">[RFC7230]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7232">[RFC7232]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests</a>", RFC 7232, DOI 10.17487/RFC7232, June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.hamilton-early-deployment-quic">[I-D.hamilton-early-deployment-quic]</b>
      </td>
      <td class="top"><a>Hamilton, R.</a>, <a>Iyengar, J.</a>, <a>Swett, I.</a> and <a>A. Wilk</a>, "<a href="http://tools.ietf.org/html/draft-hamilton-early-deployment-quic-00">QUIC: A UDP-Based Secure and Reliable Transport for HTTP/2</a>", Internet-Draft draft-hamilton-early-deployment-quic-00, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.hildebrand-deth">[I-D.hildebrand-deth]</b>
      </td>
      <td class="top"><a>Hildebrand, J.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/draft-hildebrand-deth-00">DNS Editing Through HTTPS (DETH)</a>", Internet-Draft draft-hildebrand-deth-00, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.hoffman-dns-in-json">[I-D.hoffman-dns-in-json]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a>, "<a href="http://tools.ietf.org/html/draft-hoffman-dns-in-json-09">Representing DNS Messages in JSON</a>", Internet-Draft draft-hoffman-dns-in-json-09, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.nottingham-json-home">[I-D.nottingham-json-home]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a>, "<a href="http://tools.ietf.org/html/draft-nottingham-json-home-04">Home Documents for HTTP APIs</a>", Internet-Draft draft-nottingham-json-home-04, May 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.song-dns-wireformat-http">[I-D.song-dns-wireformat-http]</b>
      </td>
      <td class="top"><a>Song, L.</a>, <a>Vixie, P.</a>, <a>Kerr, S.</a> and <a>R. Wan</a>, "<a href="http://tools.ietf.org/html/draft-song-dns-wireformat-http-04">DNS wire-format over HTTP</a>", Internet-Draft draft-song-dns-wireformat-http-04, June 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5001">[RFC5001]</b>
      </td>
      <td class="top"><a>Austein, R.</a>, "<a href="http://tools.ietf.org/html/rfc5001">DNS Name Server Identifier (NSID) Option</a>", RFC 5001, DOI 10.17487/RFC5001, August 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5785">[RFC5785]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6147">[RFC6147]</b>
      </td>
      <td class="top"><a>Bagnulo, M.</a>, <a>Sullivan, A.</a>, <a>Matthews, P.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc6147">DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>", RFC 6147, DOI 10.17487/RFC6147, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6891">[RFC6891]</b>
      </td>
      <td class="top"><a>Damas, J.</a>, <a>Graff, M.</a> and <a>P. Vixie</a>, "<a href="http://tools.ietf.org/html/rfc6891">Extension Mechanisms for DNS (EDNS(0))</a>", STD 75, RFC 6891, DOI 10.17487/RFC6891, April 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6975">[RFC6975]</b>
      </td>
      <td class="top"><a>Crocker, S.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc6975">Signaling Cryptographic Algorithm Understanding in DNS Security Extensions (DNSSEC)</a>", RFC 6975, DOI 10.17487/RFC6975, July 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7049">[RFC7049]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc7049">Concise Binary Object Representation (CBOR)</a>", RFC 7049, DOI 10.17487/RFC7049, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7159">[RFC7159]</b>
      </td>
      <td class="top"><a>Bray, T.</a>, "<a href="http://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7435">[RFC7435]</b>
      </td>
      <td class="top"><a>Dukhovni, V.</a>, "<a href="http://tools.ietf.org/html/rfc7435">Opportunistic Security: Some Protection Most of the Time</a>", RFC 7435, DOI 10.17487/RFC7435, December 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7540">[RFC7540]</b>
      </td>
      <td class="top"><a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7830">[RFC7830]</b>
      </td>
      <td class="top"><a>Mayrhofer, A.</a>, "<a href="http://tools.ietf.org/html/rfc7830">The EDNS(0) Padding Option</a>", RFC 7830, DOI 10.17487/RFC7830, May 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7871">[RFC7871]</b>
      </td>
      <td class="top"><a>Contavalli, C.</a>, <a>van der Gaast, W.</a>, <a>Lawrence, D.</a> and <a>W. Kumari</a>, "<a href="http://tools.ietf.org/html/rfc7871">Client Subnet in DNS Queries</a>", RFC 7871, DOI 10.17487/RFC7871, May 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#previous-work-on-dns-over-http-or-in-other-formats" id="previous-work-on-dns-over-http-or-in-other-formats">Previous Work on DNS over HTTP or in Other Formats</a></h1>
<p id="rfc.section.A.p.1">The following is a list of earlier work that related to DNS over HTTP or representing DNS data in other formats. It is very likely incomplete, but will be expanded as this document progresses.</p>
<p id="rfc.section.A.p.2">The list includes links to the tools.ietf.org site (because these documents are all expired) and web sites of software.</p>
<p/>

<ul>
  <li>https://tools.ietf.org/html/draft-mohan-dns-query-xml</li>
  <li>https://tools.ietf.org/html/draft-daley-dnsxml</li>
  <li>https://tools.ietf.org/html/draft-dulaunoy-dnsop-passive-dns-cof</li>
  <li>https://tools.ietf.org/html/draft-bortzmeyer-dns-json</li>
  <li>https://www.nlnetlabs.nl/projects/dnssec-trigger/</li>
</ul>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Hoffman</span> 
	  <span class="n hidden">
		<span class="family-name">Hoffman</span>
	  </span>
	</span>
	<span class="org vcardline">ICANN</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:paul.hoffman@icann.org">paul.hoffman@icann.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Joe Hildebrand</span> 
	  <span class="n hidden">
		<span class="family-name">Hildebrand</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hildjj@cursive.net">hildjj@cursive.net</a></span>

  </address>
</div>

</body>
</html>
