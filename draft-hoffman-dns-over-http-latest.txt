



Network Working Group                                         P. Hoffman
Internet-Draft                                                     ICANN
Intended status: Standards Track                           J. Hildebrand
Expires: March 17, 2017                               September 13, 2016


                         DNS Queries over HTTPS
                      draft-hoffman-dns-over-http

Abstract

   This document describes how to make DNS queries and get DNS responses
   over HTTPS.  The main driver for this document is to allow clients
   who want to send DNS queries over HTTP transport to be able to do in
   a secure and interoperable fashion, regardless of the format of the
   responses.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on March 17, 2017.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Hoffman & Hildebrand     Expires March 17, 2017                 [Page 1]

Internet-Draft                 DNS in JSON                September 2016


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Use Cases . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.2.  Protocol Requirements . . . . . . . . . . . . . . . . . .   3
     1.3.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   4
     1.4.  Queries . . . . . . . . . . . . . . . . . . . . . . . . .   4
     1.5.  Query Names and Values  . . . . . . . . . . . . . . . . .   5
     1.6.  Discovery . . . . . . . . . . . . . . . . . . . . . . . .   6
   2.  Responses . . . . . . . . . . . . . . . . . . . . . . . . . .   7
   3.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   4.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   5.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   7
   6.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   8
     6.1.  Normative References  . . . . . . . . . . . . . . . . . .   8
     6.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10

1.  Introduction

   Over time, there have been many proposals for using HTTP and HTTPS as
   a substrate for DNS queries and responses.  To date, none of those
   proposals have made it beyond early discussion, partially due to
   disagreement about what is the "best" method to do so.  In
   particular, there has been disagreement about what the best format
   for the responses should be.  Also, some early proposals have not
   followed best practices for using HTTP.

   This document defines a specific protocol for sending DNS [RFC1035]
   queries and getting DNS responses over HTTP [RFC7230] that is running
   over TLS [RFC5246].  Although there might be a desire to run this
   protocol over an insecure transport such as bare HTTP, this document
   only defines the protocol as HTTP over TLS.

   This design focuses on DNS stub-to-resolver communication, but DNS
   resolver-to-authoritative communication should work just as well.

   A server that supports this protocol is called a "DNS API server" to
   differentiate it from a "DNS server" (one that uses the regular DNS
   protocol).  Similarly, a client supports this protocol is called a
   "DNS API client".

1.1.  Use Cases

   Earlier proposals for DNS over HTTP have had many different use
   cases.  The primary use case is an application that wants to avoid
   network path involvement with DNS.  The protocol can be implemented
   in the application such as a browser if the location of the DNS API



Hoffman & Hildebrand     Expires March 17, 2017                 [Page 2]

Internet-Draft                 DNS in JSON                September 2016


   server can be configured, hard-coded, or discoverable such as through
   DHCP.

   Another use case is an operating system that wants to help
   applications when the OS detects broken DNS in its operations.  The
   OS can still respond to calls such as getaddrinfo() and
   gethostbyname() by using this protocol without the applications
   needing to do anything.

   A more recent use case is a small ("IoT") device that already runs
   COAP [RFC7252] and has a JSON [RFC7159] or CBOR [RFC7049] parser and
   wants to make DNS queries beyond what are supported by the device's
   operating system.

   An eventual use case might be editing of DNS zones by end users, such
   as described in [I-D.hildebrand-deth].  Such editing could easily be
   done using existing HTTP semantics.

   As HTTP/2 [RFC7540] becomes more widely deployed, this use case might
   become more important because an HTTP/2 server might push DNS
   responses to a client that the HTTP/2 server expects the client to
   look up.

1.2.  Protocol Requirements

   The protocol described here bases its design on the following
   protocol requirements:

   o  The protocol must use HTTP semantics the way that they are
      commonly used in other protocols; there is nothing special about
      the DNS use case.

   o  The protocol must run over secure transport.

   o  The query format must be able to be flexible enough to express
      every normal DNS query.

   o  The response must be able to be in different formats that can be
      described by different documents.

   o  Both the query format and the response formats must be extensible.
      In specific, a query must be able to contain one or more EDNS
      extensions, including those not yet defined.  Further, it must be
      easy to define different response formats and to extend already-
      defined formats.

   A non-requirement for this protocol is that is needs to work with
   DNS64 [RFC6147].



Hoffman & Hildebrand     Expires March 17, 2017                 [Page 3]

Internet-Draft                 DNS in JSON                September 2016


1.3.  Terminology

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
   and "OPTIONAL" are to be interpreted as described in BCP 14, RFC 2119
   [RFC2119].

1.4.  Queries

   The DNS API client finds a DNS API server through the same mechanism
   as for a DNS resolver: DHCPv4, DHCPv6, IPv6 RA, and configuration.
   The DNS API client then discovers the server's capabilities and URI
   temple using the mechanism described in Section 1.6.  The URI
   templates used in this protocol MUST be "https:" or "coaps:" for the
   scheme.

   To send a DNS query, the DNS API client prepares an HTTP GET request
   and sends it to the URI it received from the discovery step.  The
   query is encoded as a set of name/value components using the HTTP
   "?name=value" syntax, with an "&" character between each pair.  Names
   and values are defined in Section 1.5.

   The HTTP-related requirements include:

   o  The HTTP GET request MUST have no body.

   o  The HTTP GET request SHOULD be sent with an HTTP "Accept:" header
      to say what type of content can be returned.  If the request does
      not have an HTTP "Accept:" header, the DNS API server might return
      a content type that the DNS API client does not understand.

   o  The HTTP GET request SHOULD use If-None-Match headers if earlier
      responses to the same query used HTTP ETag headers as described in
      [RFC7232].

   For example, assume that the server's template for the query is:

      https://dnsserver.example.com/

   A query for the A records for www.somecompany.com would be:

      https://dnsserver.example.com/?qn=www.somecompany.com&qt=1

   The HTTP request might look like:







Hoffman & Hildebrand     Expires March 17, 2017                 [Page 4]

Internet-Draft                 DNS in JSON                September 2016


      GET /?qn=www.somecompany.com&qt=1 HTTP/1.1
      User-Agent: curl/7.16.3 libcurl/7.16.3
      Host: dnsserver.example.com
      Accept: application/dns+json

   This document only defines the semantics of the HTTP GET command for
   normal DNS queries and responses.  Other verbs will be defined in the
   future.  Other verbs will likely need different authorization
   semantics as well as different discoverability for the template.  For
   example, see [I-D.hildebrand-deth].

1.5.  Query Names and Values

   The following are the names and descriptions of values for DNS API
   queries.  Every query MUST have a "qn" component and a "qt"
   component; all other components are optional.  DNS header values and
   extensions that are not appropriate for queries are not defined.

   Note that a query can only include a single qn and a single qt
   component.  Although it may be tempting to include multiple qt
   components (such as a single query for A and AAAA records), DNS
   implementations historically have not dealt consistently with these.
   If there are future standards for queries for multiple names and
   types, new components for those standards can be defined.

   qn:  QNAME from RFC 1035

   qt:  QTYPE from RFC 1035

   qc:  QCLASS from RFC 1035 - if omitted, server assumes 1

   id:  ID from RFC 1035 - if omitted, there is no default value

   opcode:  Opcode from RFC 1035 - if omitted, server assumes 0

   rd:  RD from RFC 1035 - if omitted, server assumes 1

   cd:  CD from RFC 4035 - if omitted, server assumes 0

   do:  DO from RFC 4035 - if omitted, server assumes 1

   The following are EDNS0 [RFC6891] extensions.  If an extension is
   omitted, the server assumes that the extension was not given in the
   request.

   nsid:  Request the server's NSID, based on [RFC5001]





Hoffman & Hildebrand     Expires March 17, 2017                 [Page 5]

Internet-Draft                 DNS in JSON                September 2016


   dau:  Specify the list of signing algorithms understood, based on
      [RFC6975].  The value is a list of integers separated by commas
      (with no spaces).

   dhu:  Specify the list of hash algorithms understood, based on
      [RFC6975].  The value is a list of integers separated by commas
      (with no spaces).

   n3u:  Specify the list of NSEC3 hash algorithms understood, based on
      [RFC6975].  The value is a list of integers separated by commas
      (with no spaces).

   ecs:  Specify the client subnet, based on [RFC7871].  The value is
      the bytes of the ECS option, starting with byte 4, encoded in
      lowercase hexadecimal.

   pad:  Optional padding, used for the same purposes as described in
      [RFC7830].

   See Section 3 for a registry for additional names for queries.

1.6.  Discovery

   A DNS API client discovers the capabilities of the DNS API server
   using [I-D.nottingham-json-home].  For queries, the link relation is
   TBD.

   Note that the response to this discover might be multiple templates.
   In those templates, some of the URI types might not be supported by
   the resolver; this is fine as long as at least one type is.  For
   example, if a discovery query returns both https: and coaps: URI
   templates, but the DNS API client can only generate https: queries,
   the other URI templates are ignored.

   If a DNS API client only has a DNS resolver address but no
   configuration for a DNS API server, the client can still use the
   discovery query to see if that DNS resolver is acting as a DNS API
   server.  That is, some DNS resolvers will run both the DNS protocol
   on port 53 and the DNS API on a different port.

   The discovery response may give hints that the DSN API server
   requires a form of HTTP authorization.  The configuration of that
   authorization is out of scope for the DNS API protocol.  TODO: Need
   to think about HTTP authorization mechanisms.  This would allow user
   tracking, but could also free resolvers from having to use IP address
   ranges for filtering.  Several bad ideas are likely here, so let's
   think about it early.




Hoffman & Hildebrand     Expires March 17, 2017                 [Page 6]

Internet-Draft                 DNS in JSON                September 2016


   TODO: Need to think about how to get both an IP address and domain
   name for the SNI for HTTPS.  Some ideas might come from RFC 7858.

2.  Responses

   Different response formats will provide more or less information from
   a DNS response.  For example, one response type might include the
   information from the DNS header bytes while another might omit it.
   The amount and type of information that a response format gives is
   solely up to the format, and not defined in this protocol.

   At the time this is published, the response types are works in
   progress.  The know response types include:

   o  [I-D.hoffman-dns-in-json] describes a response type in JSON

   o  [I-D.song-dns-wireformat-http] describes a response type in DNS
      wire format

   In the HTTP responses, the HTTP cache headers are set to shortest DNS
   TTL in the response.  The HTTP responses SHOULD set the HTTP ETag
   headers as described in [RFC7232].

3.  IANA Considerations

   TODO: Create a new registry for option names for DNS queries.  This
   will be a simple registry for new option names, probably with a
   designated expert.

4.  Security Considerations

   This protocol requires the use of TLS for communication.  If a client
   does not enforce authentication of the TLS server, the communication
   channel will be susceptible to many security problems.  See [RFC7435]
   for a fuller description of non-authenticated TLS.

   TODO: Think about whether cross-origin resource sharing (CORS)
   applies to this protocol and, if so, how to specify it.

5.  Acknowledgements

   Early input to this document came from Mark Nottingham and and
   Patrick McManus.








Hoffman & Hildebrand     Expires March 17, 2017                 [Page 7]

Internet-Draft                 DNS in JSON                September 2016


6.  References

6.1.  Normative References

   [I-D.nottingham-json-home]
              Nottingham, M., "Home Documents for HTTP APIs", draft-
              nottingham-json-home-04 (work in progress), May 2016.

   [RFC1035]  Mockapetris, P., "Domain names - implementation and
              specification", STD 13, RFC 1035, DOI 10.17487/RFC1035,
              November 1987, <http://www.rfc-editor.org/info/rfc1035>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC5246]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", RFC 5246,
              DOI 10.17487/RFC5246, August 2008,
              <http://www.rfc-editor.org/info/rfc5246>.

   [RFC7230]  Fielding, R., Ed. and J. Reschke, Ed., "Hypertext Transfer
              Protocol (HTTP/1.1): Message Syntax and Routing",
              RFC 7230, DOI 10.17487/RFC7230, June 2014,
              <http://www.rfc-editor.org/info/rfc7230>.

   [RFC7232]  Fielding, R., Ed. and J. Reschke, Ed., "Hypertext Transfer
              Protocol (HTTP/1.1): Conditional Requests", RFC 7232,
              DOI 10.17487/RFC7232, June 2014,
              <http://www.rfc-editor.org/info/rfc7232>.

6.2.  Informative References

   [I-D.hildebrand-deth]
              Hildebrand, J. and P. Hoffman, "DNS Editing Through HTTPS
              (DETH)", draft-hildebrand-deth-00 (work in progress),
              March 2016.

   [I-D.hoffman-dns-in-json]
              Hoffman, P., "Representing DNS Messages in JSON", draft-
              hoffman-dns-in-json-07 (work in progress), September 2016.

   [I-D.song-dns-wireformat-http]
              Song, L., Vixie, P., Kerr, S., and R. Wan, "DNS wire-
              format over HTTP", draft-song-dns-wireformat-http-04 (work
              in progress), June 2016.




Hoffman & Hildebrand     Expires March 17, 2017                 [Page 8]

Internet-Draft                 DNS in JSON                September 2016


   [RFC5001]  Austein, R., "DNS Name Server Identifier (NSID) Option",
              RFC 5001, DOI 10.17487/RFC5001, August 2007,
              <http://www.rfc-editor.org/info/rfc5001>.

   [RFC6147]  Bagnulo, M., Sullivan, A., Matthews, P., and I. van
              Beijnum, "DNS64: DNS Extensions for Network Address
              Translation from IPv6 Clients to IPv4 Servers", RFC 6147,
              DOI 10.17487/RFC6147, April 2011,
              <http://www.rfc-editor.org/info/rfc6147>.

   [RFC6891]  Damas, J., Graff, M., and P. Vixie, "Extension Mechanisms
              for DNS (EDNS(0))", STD 75, RFC 6891,
              DOI 10.17487/RFC6891, April 2013,
              <http://www.rfc-editor.org/info/rfc6891>.

   [RFC6975]  Crocker, S. and S. Rose, "Signaling Cryptographic
              Algorithm Understanding in DNS Security Extensions
              (DNSSEC)", RFC 6975, DOI 10.17487/RFC6975, July 2013,
              <http://www.rfc-editor.org/info/rfc6975>.

   [RFC7049]  Bormann, C. and P. Hoffman, "Concise Binary Object
              Representation (CBOR)", RFC 7049, DOI 10.17487/RFC7049,
              October 2013, <http://www.rfc-editor.org/info/rfc7049>.

   [RFC7159]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", RFC 7159, DOI 10.17487/RFC7159, March
              2014, <http://www.rfc-editor.org/info/rfc7159>.

   [RFC7252]  Shelby, Z., Hartke, K., and C. Bormann, "The Constrained
              Application Protocol (CoAP)", RFC 7252,
              DOI 10.17487/RFC7252, June 2014,
              <http://www.rfc-editor.org/info/rfc7252>.

   [RFC7435]  Dukhovni, V., "Opportunistic Security: Some Protection
              Most of the Time", RFC 7435, DOI 10.17487/RFC7435,
              December 2014, <http://www.rfc-editor.org/info/rfc7435>.

   [RFC7540]  Belshe, M., Peon, R., and M. Thomson, Ed., "Hypertext
              Transfer Protocol Version 2 (HTTP/2)", RFC 7540,
              DOI 10.17487/RFC7540, May 2015,
              <http://www.rfc-editor.org/info/rfc7540>.

   [RFC7830]  Mayrhofer, A., "The EDNS(0) Padding Option", RFC 7830,
              DOI 10.17487/RFC7830, May 2016,
              <http://www.rfc-editor.org/info/rfc7830>.






Hoffman & Hildebrand     Expires March 17, 2017                 [Page 9]

Internet-Draft                 DNS in JSON                September 2016


   [RFC7871]  Contavalli, C., van der Gaast, W., Lawrence, D., and W.
              Kumari, "Client Subnet in DNS Queries", RFC 7871,
              DOI 10.17487/RFC7871, May 2016,
              <http://www.rfc-editor.org/info/rfc7871>.

Authors' Addresses

   Paul Hoffman
   ICANN

   Email: paul.hoffman@icann.org


   Joe Hildebrand

   Email: hildjj@cursive.net



































Hoffman & Hildebrand     Expires March 17, 2017                [Page 10]
